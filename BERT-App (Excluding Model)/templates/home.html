<!DOCTYPE html>
<html lang="en" dir="ltr">
<!-- <link rel="stylesheet" href="css/template.css" /> -->
  <head>
    <meta charset="utf-8">
    <title>About Flask</title>
  </head>
  <body>
    <h1>Understanding the sentiment</h1>
    <p> How was the movie for you?</p>
   

    <form action="http://localhost:5000/get_sentiment" method="post" id="default" target="_blank" >
      Review: <input type="text" name="Review" id="Review" for="Review">
      <br><br>
      <button formaction="http://localhost:5000/get_sentiment" type="submit">Send Sentiment</button>
      <button class="" type="reset" name="button"><b>Reset</b></button><br>
      <!-- Upload resume: <input type="file" name="" value="" accept="pdf"> -->
    </form>
<p name="output" id="output"></p>

 <script>
  //Get the form element by id
const sampleForm = document.getElementById("default");

//Add an event listener to the form element and handler for the submit an event.
sampleForm.addEventListener("submit", async (e) => {
  /**
   * Prevent the default browser behaviour of submitting
   * the form so that you can handle this instead.
   */
  e.preventDefault();

  /**
   * Get the element attached to the event handler.
   */
  let form = e.currentTarget;

  /**
   * Take the URL from the form's `action` attribute.
   */
  let url = form.action;

  try {
    /**
     * Takes all the form fields and make the field values
     * available through a `FormData` instance.
     */
    let formData = new FormData(form);

    /**
     * The `postFormFieldsAsJson()` function in the next step.
     */
    let responseData = await postFormFieldsAsJson({ url, formData });

    //Destructure the response data
    let { serverDataResponse } = responseData;

    //Display the response data in the console (for debugging)
    console.log(serverDataResponse);

    document.getElementById("output").innerHTML = JSON.stringify(responseData);

  } catch (error) {
    //If an error occurs display it in the console (for debugging)
    console.error(error);
  }
});

/**
 * Helper function to POST data as JSON with Fetch.
 */

async function postFormFieldsAsJson({ url, formData }) {
  //Create an object from the form data entries
  let formDataObject = Object.fromEntries(formData.entries());
  // Format the plain form data as JSON
  let formDataJsonString = JSON.stringify(formDataObject);

  //Set the fetch options (headers, body)
  let fetchOptions = {
    //HTTP method set to POST.
    method: "POST",
    //Set the headers that specify you're sending a JSON body request and accepting JSON response
    headers: {
      "Content-Type": "application/json",
      Accept: "application/json",
    },
    // POST request body as JSON string.
    body: formDataJsonString,
  };

  //Get the response body as JSON.
  //If the response was not OK, throw an error.
  let res = await fetch(url, fetchOptions);

  //If the response is not ok throw an error (for debugging)
  if (!res.ok) {
    let error = await res.text();
    throw new Error(error);
  }
  //If the response was OK, return the response body.

  return res.json();
}


 </script>
  </body>
</html>
